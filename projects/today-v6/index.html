<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Today v6 — Route Day</title>
    <!-- Leaflet CSS — free, no API key -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --bg-primary: #0b0f14;
            --bg-card: #1a1e25;
            --bg-card-elevated: #242930;
            --text-primary: #ffffff;
            --text-secondary: #a0a4ab;
            --text-tertiary: #6b7078;
            --text-inverse: #0b0f14;
            --accent-blue: #5c9eff;
            --accent-blue-bg: rgba(92,158,255,0.12);
            --accent-teal: #3ecfb4;
            --accent-teal-bg: rgba(62,207,180,0.1);
            --accent-orange: #ffc554;
            --accent-orange-bg: rgba(255,197,84,0.12);
            --accent-purple: #c084fc;
            --accent-purple-bg: rgba(192,132,252,0.12);
            --accent-red: #ff5c5c;
            --accent-red-bg: rgba(255,92,92,0.12);
            --border-subtle: rgba(255,255,255,0.08);
            --border-medium: rgba(255,255,255,0.14);
            --divider: rgba(255,255,255,0.08);
            --radius-sm: 0.5rem;
            --radius-md: 0.75rem;
            --radius-lg: 1rem;
            --radius-xl: 1.25rem;
            --radius-pill: 100px;
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 0.75rem;
            --space-lg: 1rem;
            --space-xl: 1.25rem;
            --space-2xl: 1.5rem;
            --space-3xl: 2rem;
            --font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --text-xs: 0.6875rem;
            --text-sm: 0.75rem;
            --text-base: 0.875rem;
            --text-md: 0.9375rem;
            --text-lg: 1.125rem;
            --text-xl: 1.375rem;
            --text-2xl: 1.75rem;
            --text-3xl: 2.25rem;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font-family);
            background: var(--bg-primary);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            padding-bottom: 5.5rem;
        }
        .page { max-width: 430px; margin: 0 auto; }

        /* =============================================
           HEADER
           ============================================= */
        .dash-header {
            padding: calc(env(safe-area-inset-top, 2.75rem) + 0.75rem) var(--space-xl) var(--space-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .dash-header-left { flex: 1; }
        .dash-greeting {
            font-size: var(--text-2xl);
            font-weight: 800;
            letter-spacing: -0.02em;
            line-height: 1.15;
        }
        .dash-date {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
            font-weight: 600;
            margin-top: 2px;
        }
        .dash-avatar {
            width: 42px; height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            display: flex; align-items: center; justify-content: center;
            font-size: var(--text-base); font-weight: 700; color: #fff;
            flex-shrink: 0;
        }

        /* =============================================
           ROUTE SUMMARY — mini stat bar
           ============================================= */
        .route-summary {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
            padding: var(--space-md) var(--space-xl) var(--space-lg);
        }
        .route-stat {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            font-size: var(--text-sm);
            color: var(--text-secondary);
            font-weight: 600;
        }
        .route-stat svg { width: 16px; height: 16px; color: var(--text-tertiary); }
        .route-stat strong { color: var(--text-primary); font-weight: 800; }

        /* =============================================
           MAP CONTAINER — dark card style (Zillow ref)
           ============================================= */
        .map-section {
            padding: 0 var(--space-lg);
            margin-bottom: var(--space-lg);
        }
        .map-section-title {
            font-size: var(--text-xl);
            font-weight: 800;
            margin-bottom: var(--space-lg);
            padding: 0 var(--space-xs);
        }
        .map-container {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            border: 1px solid var(--border-medium);
            overflow: hidden;
            position: relative;
        }
        #map {
            width: 100%;
            height: 260px;
        }
        /* Dark map tiles overrides */
        .leaflet-container {
            background: #0b0f14 !important;
            font-family: var(--font-family) !important;
        }
        .leaflet-control-attribution {
            background: rgba(26,30,37,0.85) !important;
            color: var(--text-tertiary) !important;
            font-size: 9px !important;
            border-radius: var(--radius-sm) 0 0 0 !important;
        }
        .leaflet-control-attribution a { color: var(--text-tertiary) !important; }
        .leaflet-control-zoom { display: none !important; }

        /* Custom markers */
        .map-pin {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            border: 2px solid rgba(255,255,255,0.3);
            transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .map-pin-label {
            transform: rotate(45deg);
            font-size: 11px;
            font-weight: 800;
            color: #fff;
            font-family: var(--font-family);
        }
        .map-pin.dimmed {
            width: 24px;
            height: 24px;
            opacity: 0.45;
            border-color: transparent;
        }
        .map-pin.active {
            width: 38px;
            height: 38px;
            opacity: 1;
            border-color: #fff;
            box-shadow: 0 0 16px rgba(92,158,255,0.5);
            z-index: 999 !important;
        }
        .pin-blue { background: var(--accent-blue); }
        .pin-teal { background: var(--accent-teal); }
        .pin-orange { background: var(--accent-orange); }
        .pin-purple { background: var(--accent-purple); }

        /* Route line number badges below map */
        .map-legend {
            display: flex;
            justify-content: center;
            gap: var(--space-md);
            padding: var(--space-lg) var(--space-lg) var(--space-md);
        }
        .legend-stop {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            font-weight: 600;
            transition: color 0.2s;
        }
        .legend-stop.active { color: var(--text-primary); }
        .legend-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            transition: all 0.2s;
        }
        .legend-stop.active .legend-dot {
            width: 10px; height: 10px;
            box-shadow: 0 0 6px currentColor;
        }

        /* =============================================
           SWIPEABLE EVENT CARDS
           ============================================= */
        .events-section {
            padding: 0 0 var(--space-sm);
        }
        .events-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--space-xl);
            margin-bottom: var(--space-lg);
        }
        .events-section-title {
            font-size: var(--text-xl);
            font-weight: 800;
        }
        .events-counter {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
            font-weight: 600;
        }
        .events-scroll {
            display: flex;
            gap: var(--space-md);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0 var(--space-xl);
            scroll-snap-type: x mandatory;
            scroll-padding-left: var(--space-xl);
        }
        .events-scroll::-webkit-scrollbar { display: none; }

        .event-card {
            flex-shrink: 0;
            width: calc(100% - 3rem);
            scroll-snap-align: start;
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            border: 1.5px solid var(--border-subtle);
            padding: var(--space-2xl);
            transition: border-color 0.25s ease, box-shadow 0.25s ease;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }
        .event-card.active {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 1px var(--accent-blue), 0 4px 20px rgba(92,158,255,0.12);
        }
        .event-card-top {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: var(--space-lg);
        }
        .event-card-number {
            width: 28px; height: 28px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: var(--text-sm);
            font-weight: 800;
            color: #fff;
            flex-shrink: 0;
        }
        .event-card-type {
            font-size: 0.625rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            padding: 0.2em 0.6em;
            border-radius: var(--radius-sm);
        }
        .event-card-address {
            font-size: var(--text-lg);
            font-weight: 800;
            line-height: 1.25;
            margin-bottom: var(--space-xs);
        }
        .event-card-detail {
            font-size: var(--text-base);
            color: var(--text-secondary);
            line-height: 1.4;
            margin-bottom: var(--space-xl);
        }
        .event-card-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .event-card-time {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            font-size: var(--text-base);
            font-weight: 700;
        }
        .event-card-time svg { width: 16px; height: 16px; color: var(--text-tertiary); }
        .event-card-eta {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
            font-weight: 600;
        }
        .event-card-actions {
            display: flex;
            gap: var(--space-sm);
        }
        .event-action-btn {
            width: 36px; height: 36px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            border: 1.5px solid var(--border-medium);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
            -webkit-tap-highlight-color: transparent;
        }
        .event-action-btn:active { background: var(--bg-card-elevated); }
        .event-action-btn svg { width: 16px; height: 16px; }
        .event-action-btn.primary-action {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: #fff;
        }

        /* Scroll indicator dots */
        .scroll-dots {
            display: flex;
            justify-content: center;
            gap: 6px;
            padding: var(--space-lg) 0;
        }
        .scroll-dot {
            width: 6px; height: 6px;
            border-radius: 50%;
            background: var(--text-tertiary);
            opacity: 0.3;
            transition: all 0.2s;
        }
        .scroll-dot.active {
            width: 20px;
            border-radius: 3px;
            opacity: 1;
            background: var(--accent-blue);
        }

        /* =============================================
           DRIVE OVERVIEW CARD
           ============================================= */
        .drive-overview {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            margin: 0 var(--space-lg) var(--space-lg);
            padding: var(--space-2xl);
        }
        .drive-overview-title {
            font-size: var(--text-lg);
            font-weight: 800;
            margin-bottom: var(--space-xl);
        }
        .drive-stops {
            display: flex;
            flex-direction: column;
            gap: 0;
            position: relative;
        }
        .drive-stop {
            display: grid;
            grid-template-columns: 28px 1fr auto;
            gap: var(--space-lg);
            align-items: center;
            padding: var(--space-lg) 0;
            position: relative;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            transition: opacity 0.2s;
        }
        .drive-stop::before {
            content: '';
            position: absolute;
            left: 13px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border-subtle);
        }
        .drive-stop:first-child::before { top: 50%; }
        .drive-stop:last-child::before { bottom: 50%; }
        .drive-stop-dot {
            width: 28px; height: 28px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: var(--text-xs);
            font-weight: 800;
            color: #fff;
            z-index: 1;
            transition: all 0.25s;
        }
        .drive-stop.active .drive-stop-dot {
            transform: scale(1.15);
            box-shadow: 0 0 10px rgba(92,158,255,0.4);
        }
        .drive-stop-name {
            font-size: var(--text-base);
            font-weight: 700;
            line-height: 1.3;
        }
        .drive-stop-sub {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
        }
        .drive-stop-time {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            font-weight: 600;
            text-align: right;
        }
        .drive-stop-drive {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
        }

        /* =============================================
           DA-13: StickyBottomBar
           ============================================= */
        .sticky-bottom {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: rgba(11,15,20,0.88);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border-top: 1px solid var(--border-subtle);
            padding: var(--space-md) var(--space-xl) calc(var(--space-md) + env(safe-area-inset-bottom));
            z-index: 100;
        }
        .sticky-bottom-inner {
            max-width: 430px;
            margin: 0 auto;
            display: flex;
            gap: var(--space-md);
        }
        .btn-outline {
            padding: 0.85em 1.25em;
            border-radius: var(--radius-lg);
            border: 1.5px solid var(--accent-blue);
            background: transparent;
            color: var(--accent-blue);
            font-size: var(--text-md);
            font-weight: 700;
            font-family: var(--font-family);
            cursor: pointer;
            white-space: nowrap;
            -webkit-tap-highlight-color: transparent;
        }
        .btn-primary {
            flex: 1;
            padding: 0.85em 1.25em;
            border-radius: var(--radius-lg);
            border: none;
            background: var(--accent-blue);
            color: var(--text-inverse);
            font-size: var(--text-md);
            font-weight: 700;
            font-family: var(--font-family);
            cursor: pointer;
            text-align: center;
            -webkit-tap-highlight-color: transparent;
        }
        .btn-primary:active { opacity: 0.85; }
        .btn-primary-sub {
            display: block;
            font-size: var(--text-xs);
            font-weight: 500;
            opacity: 0.8;
            margin-top: 1px;
        }
    </style>
</head>
<body>

    <div class="page">

        <!-- Header -->
        <div class="dash-header">
            <div class="dash-header-left">
                <div class="dash-greeting" id="greeting">Good morning</div>
                <div class="dash-date" id="dateLabel">Saturday, Feb 8</div>
            </div>
            <div class="dash-avatar">JR</div>
        </div>

        <!-- Route summary stats -->
        <div class="route-summary">
            <div class="route-stat">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"/></svg>
                <strong>4</strong> stops
            </div>
            <div class="route-stat">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <strong>1h 42m</strong> driving
            </div>
            <div class="route-stat">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0H21M3.375 14.25h1.5M21 12V7.5m0 0H7.5m13.5 0l-3-3m0 0l-3 3"/></svg>
                <strong>38</strong> mi
            </div>
        </div>

        <!-- Map section — Zillow dark card style -->
        <div class="map-section">
            <div class="map-section-title">Today's route</div>
            <div class="map-container">
                <div id="map"></div>
            </div>
            <div class="map-legend">
                <div class="legend-stop active" data-idx="0">
                    <div class="legend-dot" style="background: var(--accent-blue);"></div>
                    742 Oceanview
                </div>
                <div class="legend-stop" data-idx="1">
                    <div class="legend-dot" style="background: var(--accent-teal);"></div>
                    1580 Bay
                </div>
                <div class="legend-stop" data-idx="2">
                    <div class="legend-dot" style="background: var(--accent-orange);"></div>
                    215 Elm
                </div>
                <div class="legend-stop" data-idx="3">
                    <div class="legend-dot" style="background: var(--accent-purple);"></div>
                    88 Pine Ridge
                </div>
            </div>
        </div>

        <!-- Swipeable event cards -->
        <div class="events-section">
            <div class="events-section-header">
                <div class="events-section-title">Stops</div>
                <div class="events-counter"><span id="currentStop">1</span> / 4</div>
            </div>

            <div class="events-scroll" id="eventsScroll">

                <!-- Card 1 -->
                <div class="event-card active" data-idx="0">
                    <div class="event-card-top">
                        <div class="event-card-number pin-blue">1</div>
                        <span class="event-card-type" style="background: var(--accent-blue-bg); color: var(--accent-blue);">Showing</span>
                    </div>
                    <div class="event-card-address">742 Oceanview Dr</div>
                    <div class="event-card-detail">3 bd / 2 ba · $1.2M · Buyer showing<br>The Millers — pre-approved $1.3M</div>
                    <div class="event-card-footer">
                        <div>
                            <div class="event-card-time">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                10:00 AM
                            </div>
                            <div class="event-card-eta">First stop · Leave by 9:35</div>
                        </div>
                        <div class="event-card-actions">
                            <button class="event-action-btn" aria-label="Call">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"/></svg>
                            </button>
                            <button class="event-action-btn primary-action" aria-label="Navigate">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Card 2 -->
                <div class="event-card" data-idx="1">
                    <div class="event-card-top">
                        <div class="event-card-number pin-teal">2</div>
                        <span class="event-card-type" style="background: var(--accent-teal-bg); color: var(--accent-teal);">Showing</span>
                    </div>
                    <div class="event-card-address">1580 Bay St, Unit 4</div>
                    <div class="event-card-detail">2 bd / 2 ba · $875K · Buyer showing<br>Sarah Chen — first-time buyer</div>
                    <div class="event-card-footer">
                        <div>
                            <div class="event-card-time">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                11:30 AM
                            </div>
                            <div class="event-card-eta">12 min from stop 1</div>
                        </div>
                        <div class="event-card-actions">
                            <button class="event-action-btn" aria-label="Call">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"/></svg>
                            </button>
                            <button class="event-action-btn primary-action" aria-label="Navigate">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Card 3 -->
                <div class="event-card" data-idx="2">
                    <div class="event-card-top">
                        <div class="event-card-number pin-orange">3</div>
                        <span class="event-card-type" style="background: var(--accent-orange-bg); color: var(--accent-orange);">Closing</span>
                    </div>
                    <div class="event-card-address">215 Elm St</div>
                    <div class="event-card-detail">4 bd / 3 ba · $945K · Final walkthrough & close<br>Tom Nakamura — seller side</div>
                    <div class="event-card-footer">
                        <div>
                            <div class="event-card-time">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                2:00 PM
                            </div>
                            <div class="event-card-eta">18 min from stop 2</div>
                        </div>
                        <div class="event-card-actions">
                            <button class="event-action-btn" aria-label="Call">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"/></svg>
                            </button>
                            <button class="event-action-btn primary-action" aria-label="Navigate">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Card 4 -->
                <div class="event-card" data-idx="3">
                    <div class="event-card-top">
                        <div class="event-card-number pin-purple">4</div>
                        <span class="event-card-type" style="background: var(--accent-purple-bg); color: var(--accent-purple);">Meeting</span>
                    </div>
                    <div class="event-card-address">88 Pine Ridge Rd</div>
                    <div class="event-card-detail">5 bd / 4 ba · $1.45M · Listing consultation<br>David & Maria Reyes — new listing</div>
                    <div class="event-card-footer">
                        <div>
                            <div class="event-card-time">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                4:30 PM
                            </div>
                            <div class="event-card-eta">22 min from stop 3 · Last stop</div>
                        </div>
                        <div class="event-card-actions">
                            <button class="event-action-btn" aria-label="Call">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"/></svg>
                            </button>
                            <button class="event-action-btn primary-action" aria-label="Navigate">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scroll dots -->
            <div class="scroll-dots" id="scrollDots">
                <div class="scroll-dot active"></div>
                <div class="scroll-dot"></div>
                <div class="scroll-dot"></div>
                <div class="scroll-dot"></div>
            </div>
        </div>

        <!-- Drive overview — itinerary list -->
        <div class="drive-overview">
            <div class="drive-overview-title">Route itinerary</div>
            <div class="drive-stops">
                <div class="drive-stop active" data-idx="0">
                    <div class="drive-stop-dot pin-blue">1</div>
                    <div>
                        <div class="drive-stop-name">742 Oceanview Dr</div>
                        <div class="drive-stop-sub">Showing · The Millers</div>
                    </div>
                    <div>
                        <div class="drive-stop-time">10:00 AM</div>
                        <div class="drive-stop-drive">Start</div>
                    </div>
                </div>
                <div class="drive-stop" data-idx="1">
                    <div class="drive-stop-dot pin-teal">2</div>
                    <div>
                        <div class="drive-stop-name">1580 Bay St, #4</div>
                        <div class="drive-stop-sub">Showing · Sarah Chen</div>
                    </div>
                    <div>
                        <div class="drive-stop-time">11:30 AM</div>
                        <div class="drive-stop-drive">12 min drive</div>
                    </div>
                </div>
                <div class="drive-stop" data-idx="2">
                    <div class="drive-stop-dot pin-orange">3</div>
                    <div>
                        <div class="drive-stop-name">215 Elm St</div>
                        <div class="drive-stop-sub">Closing · Tom Nakamura</div>
                    </div>
                    <div>
                        <div class="drive-stop-time">2:00 PM</div>
                        <div class="drive-stop-drive">18 min drive</div>
                    </div>
                </div>
                <div class="drive-stop" data-idx="3">
                    <div class="drive-stop-dot pin-purple">4</div>
                    <div>
                        <div class="drive-stop-name">88 Pine Ridge Rd</div>
                        <div class="drive-stop-sub">Meeting · Reyes family</div>
                    </div>
                    <div>
                        <div class="drive-stop-time">4:30 PM</div>
                        <div class="drive-stop-drive">22 min drive</div>
                    </div>
                </div>
            </div>
        </div>

        <div style="height: var(--space-3xl);"></div>
    </div>

    <!-- StickyBottomBar -->
    <div class="sticky-bottom">
        <div class="sticky-bottom-inner">
            <button class="btn-outline" id="navBtn">Navigate</button>
            <button class="btn-primary" id="ctaBtn">
                Start route
                <span class="btn-primary-sub">4 stops · 1h 42m total drive</span>
            </button>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ---- Greeting ----
        (function() {
            const h = new Date().getHours();
            document.getElementById('greeting').textContent =
                h < 12 ? 'Good morning' : h < 17 ? 'Good afternoon' : 'Good evening';
            document.getElementById('dateLabel').textContent =
                new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
        })();

        // ---- Stop data (Santa Cruz area) ----
        const stops = [
            { lat: 36.9631, lng: -122.0238, label: '1', color: '#5c9eff', name: '742 Oceanview Dr' },
            { lat: 36.9710, lng: -122.0132, label: '2', color: '#3ecfb4', name: '1580 Bay St' },
            { lat: 36.9745, lng: -122.0310, label: '3', color: '#ffc554', name: '215 Elm St' },
            { lat: 36.9580, lng: -122.0450, label: '4', color: '#c084fc', name: '88 Pine Ridge' }
        ];

        // ---- Initialize map ----
        const map = L.map('map', {
            zoomControl: false,
            attributionControl: true,
            dragging: true,
            scrollWheelZoom: false,
            doubleClickZoom: false,
            touchZoom: true
        }).setView([36.9665, -122.0290], 13);

        // Dark map tiles (CartoDB dark matter — free, no key)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        // ---- Custom markers ----
        const markers = stops.map((stop, i) => {
            const icon = L.divIcon({
                className: '',
                html: `<div class="map-pin ${i === 0 ? 'active' : 'dimmed'}" id="pin-${i}" style="background:${stop.color}"><span class="map-pin-label">${stop.label}</span></div>`,
                iconSize: [38, 38],
                iconAnchor: [19, 38]
            });
            return L.marker([stop.lat, stop.lng], { icon }).addTo(map);
        });

        // Draw route line
        const routeCoords = stops.map(s => [s.lat, s.lng]);
        L.polyline(routeCoords, {
            color: 'rgba(92,158,255,0.35)',
            weight: 3,
            dashArray: '8, 8'
        }).addTo(map);

        // ---- Active state tracking ----
        let activeIdx = 0;

        function setActiveStop(idx) {
            if (idx === activeIdx) return;
            activeIdx = idx;

            // Update pins
            stops.forEach((_, i) => {
                const pin = document.getElementById(`pin-${i}`);
                if (!pin) return;
                pin.classList.remove('active', 'dimmed');
                pin.classList.add(i === idx ? 'active' : 'dimmed');
            });

            // Pan map to active
            map.panTo([stops[idx].lat, stops[idx].lng], { animate: true, duration: 0.4 });

            // Update event cards
            document.querySelectorAll('.event-card').forEach(c => {
                c.classList.toggle('active', parseInt(c.dataset.idx) === idx);
            });

            // Update scroll dots
            document.querySelectorAll('.scroll-dot').forEach((d, i) => {
                d.classList.toggle('active', i === idx);
            });

            // Update legend
            document.querySelectorAll('.legend-stop').forEach((l, i) => {
                l.classList.toggle('active', i === idx);
            });

            // Update drive stops
            document.querySelectorAll('.drive-stop').forEach(s => {
                s.classList.toggle('active', parseInt(s.dataset.idx) === idx);
            });

            // Update counter
            document.getElementById('currentStop').textContent = idx + 1;

            // Update CTA
            const ctaBtn = document.getElementById('ctaBtn');
            ctaBtn.innerHTML = `Navigate to stop ${idx + 1}<span class="btn-primary-sub">${stops[idx].name}</span>`;
        }

        // ---- Scroll-snap detection for event cards ----
        const scrollContainer = document.getElementById('eventsScroll');
        let scrollTimeout;
        scrollContainer.addEventListener('scroll', () => {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                const cards = scrollContainer.querySelectorAll('.event-card');
                const scrollLeft = scrollContainer.scrollLeft;
                const containerWidth = scrollContainer.offsetWidth;
                let closest = 0;
                let minDist = Infinity;
                cards.forEach((card, i) => {
                    const dist = Math.abs(card.offsetLeft - scrollLeft - 20);
                    if (dist < minDist) { minDist = dist; closest = i; }
                });
                setActiveStop(closest);
            }, 60);
        });

        // ---- Tap on drive stops to scroll to card ----
        document.querySelectorAll('.drive-stop').forEach(stop => {
            stop.addEventListener('click', () => {
                const idx = parseInt(stop.dataset.idx);
                const card = scrollContainer.querySelectorAll('.event-card')[idx];
                scrollContainer.scrollTo({ left: card.offsetLeft - 20, behavior: 'smooth' });
            });
        });

        // ---- Tap on legend stops ----
        document.querySelectorAll('.legend-stop').forEach(leg => {
            leg.addEventListener('click', () => {
                const idx = parseInt(leg.dataset.idx);
                const card = scrollContainer.querySelectorAll('.event-card')[idx];
                scrollContainer.scrollTo({ left: card.offsetLeft - 20, behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
